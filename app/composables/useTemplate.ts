// TODO: all logic of template operations